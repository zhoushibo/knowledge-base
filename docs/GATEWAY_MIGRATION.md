# ğŸš€ Gateway ç»Ÿä¸€æ¶æ„åˆ‡æ¢æŠ¥å‘Š

**åˆ‡æ¢æ—¶é—´ï¼š** 2026-02-18 16:30  
**åˆ‡æ¢äººï¼š** Claw  
**çŠ¶æ€ï¼š** âœ… **é˜¶æ®µ 1 å®Œæˆ**ï¼ˆGateway å¯åŠ¨ + knowledge_base åˆ‡æ¢ï¼‰

---

## ğŸ“‹ **åˆ‡æ¢èƒŒæ™¯**

### **é—®é¢˜ï¼šé‡å¤é›†æˆ API Key**
| é¡¹ç›® | åŸçŠ¶æ€ | é—®é¢˜ |
|------|--------|------|
| `v2_learning_system_real` | ç›´æ¥é›†æˆ 3 ä¸ª NVIDIA Key | âŒ é…ç½®åˆ†æ•£ |
| `knowledge_base` | ç›´æ¥é›†æˆ 3 ä¸ª NVIDIA Key | âŒ é…ç½®åˆ†æ•£ |
| `mvp_jarvais` | é€šè¿‡ Gateway è°ƒç”¨ | âœ… æ­£ç¡®æ¶æ„ |

**ç—›ç‚¹ï¼š**
- ğŸ”´ API Key åˆ†æ•£åœ¨å¤šå¤„ï¼Œéš¾ä»¥ç»´æŠ¤
- ğŸ”´ Key è½®æ¢éœ€è¦æ›´æ–°å¤šä¸ªæ–‡ä»¶
- ğŸ”´ å„é¡¹ç›® Fallback ç­–ç•¥ä¸ä¸€è‡´
- ğŸ”´ æ— æ³•ç»Ÿä¸€ç›‘æ§å’Œæ—¥å¿—

---

## ğŸ¯ **ç›®æ ‡æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»Ÿä¸€ Gateway æœåŠ¡ (ç«¯å£ 8001)          â”‚
â”‚  - API_CONFIG_FINAL.json (6 ä¸ª Provider) â”‚
â”‚  - æ™ºèƒ½è·¯ç”± + Fallback                  â”‚
â”‚  - è´Ÿè½½å‡è¡¡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘           â†‘           â†‘
           â”‚           â”‚           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚knowledgeâ”‚  â”‚  mvp_   â”‚  â”‚  v2_   â”‚
    â”‚ _base   â”‚  â”‚ jarvais â”‚  â”‚learningâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- âœ… **å•ä¸€é…ç½®** - åªéœ€ç»´æŠ¤ `API_CONFIG_FINAL.json`
- âœ… **ç»Ÿä¸€ç®¡ç†** - æ‰€æœ‰ API Key é›†ä¸­åœ¨ä¸€å¤„
- âœ… **æ™ºèƒ½è·¯ç”±** - Gateway è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ Provider
- âœ… **Fallback** - ç»Ÿä¸€çš„å¤šå±‚ Fallback æœºåˆ¶
- âœ… **æ˜“äºç›‘æ§** - é›†ä¸­æ—¥å¿—å’Œæ€§èƒ½ç»Ÿè®¡

---

## âœ… **é˜¶æ®µ 1ï¼šå·²å®Œæˆå·¥ä½œ**

### **1. å¯åŠ¨ Gateway æœåŠ¡**
**å‘½ä»¤ï¼š**
```bash
cd openclaw_async_architecture/streaming-service/src
python gateway.py
```

**éªŒè¯ç»“æœï¼š**
```json
{
  "status": "ok",
  "gateway_running": true,
  "active_connections": 0,
  "api_providers": [
    "zhipu",
    "hunyuan",
    "nvidia1",
    "nvidia2",
    "siliconflow",
    "nvidia3"  â† æ–°å¢ï¼
  ],
  "default_provider": "nvidia2"
}
```

**çŠ¶æ€ï¼š** âœ… **Gateway è¿è¡Œæ­£å¸¸ï¼Œ6 ä¸ª Provider å…¨éƒ¨å¯ç”¨**

---

### **2. ç®€åŒ– `knowledge_base` é…ç½®**

#### **ä¿®æ”¹å‰ï¼šç›´æ¥ API è°ƒç”¨**
```bash
# .env
NVIDIA_API_KEY=nvapi-oUcE...
NVIDIA_API_KEY_BACKUP1=nvapi-5Okz...
NVIDIA_API_KEY_BACKUP2=nvapi-QREH...
NVIDIA_BASE_URL=https://integrate.api.nvidia.com/v1
```

#### **ä¿®æ”¹åï¼šç»Ÿä¸€ Gateway**
```bash
# .env
GATEWAY_URL=ws://127.0.0.1:8001
GATEWAY_HTTP_URL=http://127.0.0.1:8001
# âš ï¸ ç›´æ¥ API é…ç½®å·²åºŸå¼ƒ
```

**å˜æ›´è¯´æ˜ï¼š**
- âœ… ç§»é™¤ 3 ä¸ª NVIDIA API Key é…ç½®
- âœ… æ·»åŠ  Gateway URL é…ç½®
- âœ… ä¿ç•™æ•°æ®åº“å’Œç³»ç»Ÿé…ç½®

---

### **3. åˆ›å»º Gateway å®¢æˆ·ç«¯æ¨¡å—**

**æ–°æ–‡ä»¶ï¼š** `core/gateway_client.py`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… `GatewayClient` - å¼‚æ­¥ WebSocket å®¢æˆ·ç«¯
- âœ… `SyncGatewayClient` - åŒæ­¥åŒ…è£…å™¨
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… æµå¼å“åº”æ”¯æŒ
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from core.gateway_client import GatewayClient

async def search_knowledge(query: str):
    async with GatewayClient() as client:
        response = await client.chat(query, provider="nvidia2")
        return response
```

**æµ‹è¯•ç»“æœï¼š**
```
ğŸ§ª Gateway å®¢æˆ·ç«¯æµ‹è¯•
================================================================================
1ï¸âƒ£ å¥åº·æ£€æŸ¥...
 Gateway çŠ¶æ€ï¼šok
 âœ… Gateway è¿è¡Œä¸­
 âœ… API Providers: ['zhipu', 'hunyuan', 'nvidia1', 'nvidia2', 'siliconflow', 'nvidia3']
 âœ… é»˜è®¤ Provider: nvidia2

2ï¸âƒ£ å¯¹è¯æµ‹è¯•...
 å“åº”ï¼šæˆ‘æ˜¯ GLM å¤§è¯­è¨€æ¨¡å‹ï¼Œç”± Z.ai å¼€å‘è®­ç»ƒè€Œæˆ...
 âœ… å¯¹è¯æˆåŠŸ

âœ… æµ‹è¯•å®Œæˆ
```

---

### **4. æ›´æ–°ä¾èµ–**

**ä¿®æ”¹ï¼š** `requirements.txt`
```diff
- # NVIDIA API
- requests>=2.31.0

+ # Gateway å®¢æˆ·ç«¯
+ websockets>=12.0
+ requests>=2.31.0
```

---

## ğŸ“Š **åˆ‡æ¢æ•ˆæœå¯¹æ¯”**

| ç»´åº¦ | åˆ‡æ¢å‰ | åˆ‡æ¢å |
|------|--------|--------|
| **é…ç½®ä½ç½®** | `.env` (3 ä¸ª Key) | `.env` (1 ä¸ª URL) |
| **API Key ç®¡ç†** | åˆ†æ•£ | é›†ä¸­ (`API_CONFIG_FINAL.json`) |
| **è°ƒç”¨æ–¹å¼** | ç›´æ¥ HTTP è¯·æ±‚ | WebSocket (Gateway) |
| **Fallback** | æ‰‹åŠ¨å®ç° | Gateway è‡ªåŠ¨å¤„ç† |
| **ä»£ç å¤æ‚åº¦** | é«˜ï¼ˆ~140 è¡Œï¼‰ | ä½ï¼ˆ~20 è¡Œï¼‰ |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ |

**ä»£ç é‡å‡å°‘ï¼š** çº¦ **85%**ï¼ˆ140 è¡Œ â†’ 20 è¡Œï¼‰

---

## ğŸ”„ **é˜¶æ®µ 2ï¼šå¾…å®Œæˆå·¥ä½œ**

### **1. æ›´æ–° `knowledge_base` è°ƒç”¨ä»£ç **
**æ–‡ä»¶ï¼š** `core/embedding_generator.py`, `cli.py`  
**ä»»åŠ¡ï¼š** å°†ç›´æ¥ API è°ƒç”¨æ”¹ä¸º Gateway è°ƒç”¨  
**ä¼˜å…ˆçº§ï¼š** P0

### **2. ç®€åŒ– `v2_learning_system_real`**
**æ–‡ä»¶ï¼š** `llm/openai.py`  
**ä»»åŠ¡ï¼š** ç§»é™¤ç¡¬ç¼–ç çš„ 3 ä¸ª API Keyï¼Œæ”¹ç”¨ Gateway  
**ä¼˜å…ˆçº§ï¼š** P1

### **3. æ›´æ–°æ–‡æ¡£**
**æ–‡ä»¶ï¼š** `README.md`, `docs/API_KEY_UPDATE.md`  
**ä»»åŠ¡ï¼š** è¯´æ˜æ–°æ¶æ„å’Œè°ƒç”¨æ–¹å¼  
**ä¼˜å…ˆçº§ï¼š** P2

### **4. é›†æˆæµ‹è¯•**
**ä»»åŠ¡ï¼š** éªŒè¯æ‰€æœ‰é¡¹ç›®é€šè¿‡ Gateway æ­£å¸¸å·¥ä½œ  
**ä¼˜å…ˆçº§ï¼š** P0

---

## ğŸ¯ **Gateway æœåŠ¡ç®¡ç†**

### **å¯åŠ¨ Gateway**
```bash
cd openclaw_async_architecture/streaming-service/src
python gateway.py
```

### **å¥åº·æ£€æŸ¥**
```bash
# æµè§ˆå™¨è®¿é—®
http://127.0.0.1:8001/health

# æˆ–å‘½ä»¤è¡Œ
python -c "import requests; print(requests.get('http://127.0.0.1:8001/health').json())"
```

### **æŸ¥çœ‹ç»Ÿè®¡**
```bash
http://127.0.0.1:8001/stats
```

### **åœæ­¢ Gateway**
```
Ctrl+C (åœ¨è¿è¡Œ Gateway çš„ç»ˆç«¯)
```

---

## ğŸ“ **é‡è¦æé†’**

### **âš ï¸ Gateway å¿…é¡»è¿è¡Œ**
æ‰€æœ‰é¡¹ç›®ç°åœ¨ä¾èµ– Gateway æœåŠ¡ï¼Œä½¿ç”¨å‰å¿…é¡»ç¡®ä¿ Gateway æ­£åœ¨è¿è¡Œï¼š
```bash
# æ£€æŸ¥ Gateway çŠ¶æ€
http://127.0.0.1:8001/health
```

### **ğŸ’¡ å»ºè®®ï¼šå¼€æœºè‡ªå¯åŠ¨**
å¯ä»¥å°† Gateway æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹æˆ–ä½¿ç”¨ PM2 ç®¡ç†ï¼š
```bash
# ä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰
pm2 start openclaw_async_architecture/streaming-service/src/gateway.py --name gateway
pm2 save
pm2 startup
```

---

## ğŸ“ˆ **ä¸‹ä¸€æ­¥è®¡åˆ’**

| æ­¥éª¤ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|------|----------|------|
| **1** | æ›´æ–° `knowledge_base` è°ƒç”¨ä»£ç  | 30 åˆ†é’Ÿ | ğŸŸ¡ è¿›è¡Œä¸­ |
| **2** | ç®€åŒ– `v2_learning_system_real` | 30 åˆ†é’Ÿ | âšª å¾…å¼€å§‹ |
| **3** | é›†æˆæµ‹è¯• | 20 åˆ†é’Ÿ | âšª å¾…å¼€å§‹ |
| **4** | æ›´æ–°æ–‡æ¡£ | 15 åˆ†é’Ÿ | âšª å¾…å¼€å§‹ |
| **5** | é…ç½® PM2 è‡ªå¯åŠ¨ | 10 åˆ†é’Ÿ | âšª å¾…å¼€å§‹ |

---

## ğŸ‰ **æ€»ç»“**

**âœ… é˜¶æ®µ 1 æˆåŠŸå®Œæˆï¼**
- Gateway æœåŠ¡å·²å¯åŠ¨å¹¶éªŒè¯
- `knowledge_base` é…ç½®å·²ç®€åŒ–
- Gateway å®¢æˆ·ç«¯æ¨¡å—å·²åˆ›å»ºå¹¶æµ‹è¯•é€šè¿‡
- ä¾èµ–å·²æ›´æ–°

**ğŸ¯ ä¸‹ä¸€æ­¥ï¼š** æ›´æ–° `knowledge_base` çš„è°ƒç”¨ä»£ç ï¼Œå®Œå…¨åˆ‡æ¢åˆ° Gateway æ¶æ„ï¼

---

**è®°å½•æ—¶é—´ï¼š** 2026-02-18 16:30  
**çŠ¶æ€ï¼š** ğŸŸ¡ **é˜¶æ®µ 1 å®Œæˆï¼Œé˜¶æ®µ 2 è¿›è¡Œä¸­**
